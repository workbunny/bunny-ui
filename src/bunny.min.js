class Bunny extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"});var e=new CSSStyleSheet;e.replaceSync(this.css()),this.shadowRoot.adoptedStyleSheets=[e],this.firstRender=!0}state(e){const o=this;return new Proxy(e,{get(e,t,n){e=Reflect.get(e,t,n);return"object"==typeof e&&null!==e?o.state(e):e},set(e,t,n,r){return Reflect.set(e,t,n,r),o.updateComponent(),!0}})}updateComponent(){var e=this.render();this.#_processTemplate(e)}#_processTemplate(e){this.firstRender?(this.firstRender=!1,this.shadowRoot.innerHTML=this.#tpl(e),this.shadowRoot.querySelectorAll("[data-event]").forEach(e=>{const t=e.getAttribute("data-event").split(",");e.addEventListener(t[0],e=>{this[t[1]]&&this[t[1]].call(this,e)}),e.removeAttribute("data-event")})):(e=diff(domToVNode(parseHTML(this.shadowRoot.innerHTML)),domToVNode(parseHTML(this.#tpl(e)))),applyPatches(this.shadowRoot,e))}connectedCallback(){this.updateComponent()}#tpl(e){e=`
            let bny_tpl = \`${e=e.replace(/\{\#if\s+([^}]*)\}/g,(e,t)=>"`;if("+bnyComparison(t)+") {bny_tpl+=`").replace(/\{\#else\s+if\s+([^}]*)\}/g,(e,t)=>"`;} else if("+bnyComparison(t)+") {bny_tpl+=`").replace(/\{\#else\}/g,"`;} else {bny_tpl+=`").replace(/\{\/if\}/g,"`;}bny_tpl+=`").replace(/\{\#for\s+([^}]*)}/g,(e,t)=>"`;for("+bnyComparison(t)+") {bny_tpl+=`").replace(/\{\/for\}/g,"`;}bny_tpl+=`").replace(/\{\#each\s+([^}]+)\s+as\s+([^}]+)}/g,"`;$1.forEach(function($2){bny_tpl+=`").replace(/\{\/each\}/g,"`;});bny_tpl+=`").replace(/@([a-z]+)="([\w$]+)"/g,(e,t,n)=>`data-event="${t},${n}"`).replace(/\{\{(\w+(\.\w+)*)\}\}/g,"${bnyHtml($1)}").replace(/\{\#html\s+(\w+(\.\w+)*)\}/g,"${bnyHtml($1,false)}")}\`;
            return bny_tpl;`;try{var t=Object.keys(this);return new Function(...t,e)(...t.map(e=>this[e]))}catch(e){throw new Error("Template error, "+e.message)}}css(){return""}render(){return""}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(e,t,n){}}function bnyHtml(t,e=!0){if(null==t)return"";if("function"==typeof t)return bnyHtml(t());if(Array.isArray(t)){var n=t.length,r=new Array(n);for(let e=0;e<n;e++)r[e]=bnyHtml(t[e]);return r.join(",")}var o=String(t);if(!e)return o;const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};e=/[&<>"']/g;return e.test(o)?o.replace(e,e=>a[e]):o}function bnyComparison(e){const t={eq:"==",neq:"!=",gt:">",egt:">=",lt:"<",elt:"<=",heq:"===",nheq:"!=="};var n=Object.keys(t).sort((e,t)=>t.length-e.length).map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"),n=new RegExp(`\\b(${n})\\b`,"g");return e.replace(n,e=>t[e])}function parseHTML(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes}class VNode{constructor(e,t={},n=[],r=null,o=null){this.tag=e,this.attrs=t,this.children=n,this.key=r,this.el=o}}function domToVNode(e){let s=[];return e.forEach((t,e)=>{var n=t.nodeName.toLowerCase(),r={};if(t.attributes)for(let e=0;e<t.attributes.length;e++){var o=t.attributes[e];r[o.name]=o.value}var a=domToVNode(t.childNodes);"#text"===n?s.push(t.textContent):s.push(new VNode(n,r,a,e,t))}),s}function diff(t,n){var r=[];for(let e=0;e<t.length;e++){var o,a=t[e],s=n[e];s?"string"==typeof a||"string"==typeof s?a!==s&&r.push({type:"UPDATE",index:e,oldNode:a,newNode:s}):a.tag!==s.tag?r.push({type:"REPLACE",index:e,oldNode:a,newNode:s}):(o=diffAttrs(a.attrs,s.attrs),0<Object.keys(o).length&&r.push({type:"ATTR",index:e,attrs:o}),0<(o=diff(a.children,s.children)).length&&r.push({type:"CHILDREN",index:e,patches:o})):r.push({type:"REMOVE",index:e,node:a})}for(let e=t.length;e<n.length;e++)r.push({type:"ADD",index:e,node:n[e]});return r}function diffAttrs(e,t){var n,r,o={};for(n in t)e[n]!==t[n]&&(o[n]=t[n]);for(r in e)t.hasOwnProperty(r)||(o[r]=void 0);return o}function applyPatches(t,e){e.forEach(e=>{switch(e.type){case"ADD":addNode(t,e.index,e.node);break;case"REMOVE":removeNode(t,e.index,e.node);break;case"UPDATE":updateNode(t,e.index,e.oldNode,e.newNode);break;case"REPLACE":replaceNode(t,e.index,e.oldNode,e.newNode);break;case"ATTR":updateAttrs(t,e.index,e.attrs);break;case"CHILDREN":applyPatches(t.childNodes[e.index],e.patches)}})}function addNode(e,t,n){n=createElement(n);t>=e.childNodes.length?e.appendChild(n):e.insertBefore(n,e.childNodes[t])}function removeNode(e,t,n){e.childNodes[t]&&e.removeChild(e.childNodes[t])}function updateNode(e,t,n,r){e.childNodes[t]&&(e.childNodes[t].textContent=r)}function replaceNode(e,t,n,r){e.childNodes[t]&&(r=createElement(r),e.replaceChild(r,e.childNodes[t]))}function updateAttrs(e,t,n){var r=e.childNodes[t];if(r)for(var o in n)void 0===n[o]?r.removeAttribute(o):r.setAttribute(o,n[o])}function createElement(e){if("string"==typeof e)return document.createTextNode(e);const t=document.createElement(e.tag);for(var n in e.attrs)t.setAttribute(n,e.attrs[n]);return e.children.forEach(e=>{t.appendChild(createElement(e))}),t}